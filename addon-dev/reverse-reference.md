---
title: 逆引きリファレンス
description: RealTrainMod（RTM）のアドオンの目的別リファレンス。ドアの開閉や車内放送の追加、運転台の動かし方など、やり方のわからない機能の実装方法をまとめて掲載！これを見れば好きな機能が付け放題！
published: false
date: 2025-05-06T00:45:54.109Z
tags: アドオン制作
editor: markdown
dateCreated: 2025-03-08T06:42:14.384Z
---

# アドオン制作 逆引きリファレンス
RealTrainMod（RTM）において、頻繁に質問されるアドオンの機能実装方法について、目的別に解説します。

### ドアの動作
JSONまたは描画スクリプトで動作を設定します。  
一体として動かすドアをそれぞれ独立したオブジェクトとしてモデリングし、そのオブジェクトに対して動作を設定してください。  
一般的な二枚引き戸を持つ電車では、左前、左後、右前、右後の四つに区分することが多いです。

### 低床車両の制作
車両底面の高さの座標が負の値になるようにモデルを制作します。  
線路天面が-1mとなるため、それを考慮して設計してください。

### カスタムボタンを使用した種別変更
JSONでカスタムボタンを定義し、その値を描画スクリプトから取得します。  
取得した値を元に条件分岐を行い、描画処理を実装します。

### 特殊発光の実装
特殊発光は、車両の車内部分を前照灯として実装し、点灯させることで夜間やトンネル内で車内部分のみを発光させるテクニックです。  
デフォルト機能のみで実装する方法と、描画スクリプトを使用する方法があります。

#### 基本の手順
1. 光らせたい部位（主に客室）と、それ以外の部位を別々にマッピングします。
2. 光らせたい部位に対して、通常の手順で前照灯を実装します。
3. Minecraft内で「前照灯・尾灯オン」を指定します。  
   これにより、通常は点灯しない中間車を含むすべての車両のライトが点灯します。

ただし、先頭車両の前照灯・尾灯が進行方向に関係なく常時点灯するため、そのままではライトが本来の動作をしなくなります。  
そのため、以下の2つの車両モデルを別々に実装し、進行方向に応じて適切に設置・撤去を行うことで対応します。

1. 尾灯部分に発光を設定しない先頭車専用モデル
2. 前照灯部分に発光を設定しない後尾車専用モデル

描画スクリプトを使用する場合は、進行方向を検知し、それに応じて前照灯・尾灯の発光部分の描画を切り替えることで、単一の車両モデルで対応可能です。

以下は、冬嶺氏による解説ツイートです。
<blockquote class="twitter-tweet" data-lang="ja" data-dnt="true" data-theme="dark"><p lang="ja" dir="ltr">特殊発光については発案者であるmeitetsu600Vさんにお聞きした方が確実だと思いますが、一応説明をしてみます。<br>特殊発光はRTMの前照灯機能を使って内装を発光させるテクニックですが、前提としてRTM内でのライトの挙動を図解します。→<a href="https://twitter.com/hashtag/odaibako_fuyuzero?src=hash&amp;ref_src=twsrc%5Etfw">#odaibako_fuyuzero</a> <a href="https://t.co/AjE88tGLAw">https://t.co/AjE88tGLAw</a> <a href="https://t.co/MZq2KsnIKi">pic.twitter.com/MZq2KsnIKi</a></p>&mdash; 冬嶺 (@fuyuzero) <a href="https://twitter.com/fuyuzero/status/1408596321401905152?ref_src=twsrc%5Etfw">2021年6月26日</a></blockquote> 

### 方向幕の実装
方向幕のテクスチャを制作し、JSONで実装します。

### 時間で切り替わる方向幕の実装
方向幕を通常のオブジェクトとして描画し、描画スクリプトで現在時間を取得します。  
取得した時間を元に条件分岐を行い、描画する行先や種別を切り替えます。

### SoundLibの使用
SoundLibは、音声ファイル（`.ogg`）やその再生条件を定義したスクリプト（`.js`）を含むzip形式の配布物です。  
JSONで指定されたファイルがアドオンに含まれるかどうかを区別しないため、他のアドオンに含まれるファイルを自由に参照できます。  
これを利用して、外部から音声ファイルを読み込み、リアルな音声を簡単に実装できます。

### 複数のスクリプトを同時に使用する方法
`include`文を使用して外部スクリプトを読み込みます。ただし、読み込むスクリプトの内容がインライン展開されるため、名前衝突に注意してください。  
また、RTMで使用可能な`var`宣言は同じ変数を複数回宣言してもエラーにならないため、この点にも注意が必要です。

### スクリプトを統合する方法
RTMのスクリプトにはモジュールバンドラーがないため、依存関係を解決するにはコードを手動でコピーアンドペーストしてください。

### 最高速度・加速度・減速度の設定
最高速度と加速度はJSONで設定できます。  
減速度はKaizPatchを使用している場合にのみJSONで設定可能です。

### 追加パーツの使用
3DCG制作ソフトの「インポート」や「マージ」機能を使用して追加パーツを読み込みます。  
Metasequoia4の場合は「ファイル」 -> 「オブジェクトの挿入」を使用します。  
追加のテクスチャが必要な場合は、マッピングの変更や材質の追加を行ってください。

### 座席の設定
JSONで`seatPos`や`slotPos`（RTM1）、`seatPosF`（RTM2）を使用して設定します。  
`seatPos`はMinecraftのブロックの1px単位、`slotPos`や`seatPosF`はメートル単位で指定します。

### JSONとスクリプトの併用
描画スクリプトを指定すると、JSONでの処理は無視されるため、基本的に併用はできません。

### パンタグラフをw51規格に対応させる
パンタグラフの集電舟、並びにすり板の架線との接触面の高さが、+4.10mになる[^1]ようにモデルを制作します。

<!-- [メモ]
# 3Dモデル制作
## 車両モデルの制作
## 照明モデルの作成
### 半透明の処理
## テクスチャとマッピング
### 正確にマッピングする
### 半透明を有効化する
# スクリプトと動作設定
## 車掌スクリプトを使う
# サウンド関連
## 車内放送を実装する
## サウンドの問題解決
# トラブルシューティング
## 方向幕が真っ白になる
## サウンドの指定ができない
## 半透明が正しく表示されない
# Metasequoia 4の操作方法
## グリッド線を削除する
## 移動ツールの問題を解決する
## ブーリアン処理のコツ
## マッピングをする
## 材質を追加・設定する
 -->

[^1]: hi03著「W51 規格 説明書」