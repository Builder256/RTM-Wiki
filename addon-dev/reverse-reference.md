---
title: 逆引きリファレンス
description: RealTrainMod（RTM）のアドオンの目的別リファレンス。ドアの開閉や車内放送の追加、運転台の動かし方など、やり方のわからない機能の実装方法をまとめて掲載！これを見れば好きな機能が付け放題！
published: false
date: 2025-03-30T09:21:37.179Z
tags: アドオン制作
editor: markdown
dateCreated: 2025-03-08T06:42:14.384Z
---

# アドオン制作 逆引きリファレンス
RealTrainMod（RTM）において、頻繁にアドオンに実装する方法を質問される機能について、目的別に方法を紹介します。


### ドアの動作
JSONまたは描画スクリプトで、動作の設定が必要です。
一体として動かすドアをそれぞれ独立したオブジェクトとしてモデリングし、そのオブジェクトに対して動作を設定します。
各二枚の引き戸を持つ通常の一般形電車においては、左前、左後、右前、右後の四つに区分することが一般的です。

### 低床車両の制作
車両底面の高さの座標が負の値になるようにモデルを制作します。
線路天面が-1mとなるため、それを考慮します。

### カスタムボタンを使用した種別変更
JSONでカスタムボタンを定義し、その値を描画スクリプトから取得します。
取得した値を元に条件分岐を行った描画処理を実装します。

### 特殊発光の実装
特殊発光は、車両の車内の部分に対して前照灯として実装し、点灯させることによって、夜間・トンネルなどの暗い環境下で車内部分のみを発光させるテクニックです。
主にデフォルトの機能のみで実装する手法と、描画スクリプトも使用して実装する手法が知られています。

また、特殊発光に似たテクニックとして、「強制発光」があります。
こちらは、OpenGLのメソッドを使用して、RTMに関係なく指定したオブジェクトを発光させることで、車内部分のみが発光する動作を実現します。

#### 基本の手順
1. 光らせたい部位（主に客室）と、それ以外の部位を完全に別の箇所にマッピングする。
2. 光らせたい部位に対して、通常の手順で前照灯の実装を行う。
3. Minecraft内で「前照灯・尾灯オン」を指定する。
    「前照灯・尾灯オン」を指定することで、通常は点灯しない中間車を含むすべての車両のライトが点灯することを利用しています。

先頭車両の前照灯・尾灯が進行方向にかかわらず常時点灯するようになるため、そのままではライトが本来の動作をしなくなります。
そのため、先頭車両については、以下の二つの車両モデルを別々に実装し、それらを進行方向に対して、適切に設置・撤去を行うことで、本来の動作を実現します。

1. 尾灯部分に対して発光を設定しない先頭車専用の車両モデル
2. 前照灯部分に対して発光を設定しない後尾車専用の車両モデル

描画スクリプトを使用する場合には、進行方向を検知し、それに応じて前照灯・尾灯の発光部分の描画を切り替えることで、単一の車両モデルで本来の動作を実現します。

<blockquote class="twitter-tweet" data-lang="ja" data-dnt="true" data-theme="dark"><p lang="ja" dir="ltr">特殊発光については発案者であるmeitetsu600Vさんにお聞きした方が確実だと思いますが、一応説明をしてみます。<br>特殊発光はRTMの前照灯機能を使って内装を発光させるテクニックですが、前提としてRTM内でのライトの挙動を図解します。→<a href="https://twitter.com/hashtag/odaibako_fuyuzero?src=hash&amp;ref_src=twsrc%5Etfw">#odaibako_fuyuzero</a> <a href="https://t.co/AjE88tGLAw">https://t.co/AjE88tGLAw</a> <a href="https://t.co/MZq2KsnIKi">pic.twitter.com/MZq2KsnIKi</a></p>&mdash; 冬嶺 (@fuyuzero) <a href="https://twitter.com/fuyuzero/status/1408596321401905152?ref_src=twsrc%5Etfw">2021年6月26日</a></blockquote> 

### 方向幕の実装
方向幕のテクスチャを制作し、JSONで実装します。

### 時間で切り替わる方向幕の実装
方向幕をデフォルトの機能ではなく、通常のオブジェクトとして描画します。
描画スクリプトで現在時間を取得し、その値と適当な値との剰余を元に条件分岐を行い、それに応じて描画する行先・種別を切り替えます。

### SoundLibの使用
SoundLibは、音声ファイル`.ogg`やその再生条件について定義された音声スクリプト`.js`を含むzip形式の配布物です。

RTMでは、JSONで指定されたファイルがそのアドオンに含まれるかどうかを区別しないため、他のアドオンに含まれるファイルを自由に参照することができます。
それを利用して、制作のハードルが高い音声関連のファイルを、外部から読み込むことで手軽にリアルな音声を実装できます。

使用するサウンドスクリプトや音声のファイルパスを通常通りJSONにて指定し、SoundLibを前提としてアドオンと同時に導入します。

### 複数のスクリプトを同時に使用する方法
include文を使用することで、外部のスクリプトを読み込むことができます。
しかしながら、ES Modulesのimport文や、Common JSのrequire文とは異なり、使用する要素を個別に指定することはできず、読み込むスクリプトの内容の全てを読み込んだ箇所にインライン展開するため、名前衝突に注意する必要があります。
また、RTMで使用可能な`var`宣言は同じ変数を同じスコープで複数回宣言してもエラーにならないため、この点にも注意する必要があります。

### スクリプトを統合する方法
RTMのスクリプトには、通常のJavaScriptとは違い、依存関係を解決するモジュールバンドラーはありません。
適切にコードをコピーアンドペーストしましょう。

### 最高速度・加速度・減速度の設定
最高速度・加速度はそれぞれJSONで設定することができます。
減速度はKaizPatchでのみJSONで設定することができます。

### 追加パーツの使用
お使いの3DCG制作ソフトの、「インポート」や「マージ」などと呼ばれる機能を使用し、追加したいパーツを読み込みます。
Metasequoia4の場合には、「ファイル」 -> 「オブジェクトの挿入」です。

また、追加のテクスチャが必要な場合には、マッピングの変更や材質の追加を行う必要があります。

参考動画（現在非公開）：https://www.youtube.com/watch?v=a6X34My_wmI

### 座席の設定
JSONにて`seatPos`や`slotPos`(RTM1)、`seatPosF`(RTM2)を使用して設定します。
`seatPos`はMinecraftのブロックの1px単位、`slotPos`、`seatPosF`はメートル単位です。

### JSONとスクリプトの併用
描画スクリプトのファイルを指定した段階で、JSONでの処理は無視されるようになるため、併用は基本的に不可能です。

<!-- 
# 3Dモデル制作
## 車両モデルの制作
### パンタグラフをw51規格に対応させる
パンタグラフの集電舟、並びにすり板の架線との接触面の高さが、+4.10mになる[^1]ようにモデルを制作します。
## 照明モデルの作成
### 半透明の処理
## テクスチャとマッピング
### 正確にマッピングする
### 半透明を有効化する
# スクリプトと動作設定
## 車掌スクリプトを使う
# サウンド関連
## 車内放送を実装する
## サウンドの問題解決
# トラブルシューティング
## 方向幕が真っ白になる
## サウンドの指定ができない
## 半透明が正しく表示されない
# Metasequoia 4の操作方法
## グリッド線を削除する
## 移動ツールの問題を解決する
## ブーリアン処理のコツ
## マッピングをする
## 材質を追加・設定する
 -->

[^1]: hi03著「W51 規格 説明書」